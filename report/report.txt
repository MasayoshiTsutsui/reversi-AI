05-201020 筒井政成

~~実装内容~~

私が実装したオセロAIには、1手目から20手目までの序盤における戦略と、21手目から52手目までの中盤における戦略と、
53手目から終局に至るまでの終盤における戦略を分けて実装した。


まず、序盤についてだが、これはlogistelloという有名なオセロAIの対戦履歴(logbook.gam)をデータベースに据え、
今まで打たれた手と一致する流れがデータベースの中に存在すれば、logistelloが次に打った手と同じ手を打つように実装した。
いわゆる、名人の手を真似る、というやりかたである。

ここで工夫というより少し頭をひねった点としては、オセロの盤面には対称性があるため、
logistelloの対戦履歴データベース（一局ごとに、打たれた手が羅列されている）が、すべて初手をd3に打ったものとして記録されており、
それに対応できるように、実際に打たれた1手目の位置によって、以降の盤面の解釈を変えさせた点である。

具体的にどういうことかというと、

まず自分が先手であるときは、1手目は必ずd3にうつようにプログラムし、あとは何もしない。
1手目がd3でありさえすれば、データベースはそのまま利用することができるからだ。

一方、自分が後手であったときは、相手が1手目にどこに打ってきたかで、データベースの参照の仕方を変えなければならない。
たとえば、1手目に相手がc4を打った時、以降の自分の手と相手の手の羅列は、データベースのそれとは絶対に一致する部分がなくなる。（データベースは初手がd3の対戦履歴しかもたないため）
これをうまくデータベースに添わせるためには、これ以降、自分の手と相手の手の列と行を入れ替えた、
"各手を、c4をd3とみなした盤面における手に変換したもの"
の羅列を、データベースと比較することで、初手がd3以外の場合にも有効にデータベースを参照することができた。（もちろん、データベースを参照して抽出した次の1手を、再度元の盤面上での1手に変換し直すことも忘れてはならない）
これを、初手がe6,f5に打たれたときも、同様に適切な盤面の変換を行うようにしてデータベースを有効利用することができた。e6は盤面を180度回転させた盤面上での手に変換、f5では列と行の入れ替えと盤面の180度回転をどちらも行えば、d3に合わせられた。

このようにして、データベースから検索した次の1手を打ち、もしデータベースにヒットしなかった場合は、以下で述べる中盤の戦略アルゴリズムではじき出された1手を打ちように仕向けた。


続いて中盤についてだが、ここでは主に有効手すべてを私が構成した評価関数に投げ、出力された評価値の最も高かった有効手を採用して打つ、という実装にした。

評価関数の中身としては、
・盤面において取ると強いマス目かどうかを静的に評価
・その手番から4手先における自分の有効手の数が最も多い盤面に至れる最初の1手がどれかを動的に評価
の2つの要素を総合的に判断する機構を組み込んだ。

前者は、単純に各マス目に正負含めた評価値を持たせ、（角は+45,その両隣は-16といった具合）、有効手1つ1つにその値をそのまま与える。

この値に、その手を打った後の4手先の自分の有効手数の最小値の中でもっとも大きいもの（自分の有効手を少なくするように打つだろうという予測の下のmin-max法を採用しているため）を加えて、最終的な評価値とした。


そして終盤においては、授業内でprologで実装した〇×ゲームの終局読み切りとほぼ同様のものを実装し、もし必勝手があるならばその手を打ち、無ければ中盤と同じ戦略を取るように実装した。



~~友人との対戦を踏まえた考察~~

今回は、友人の久保龍哉君のオセロAIとの対戦を見て推測した私のAIの弱点を考察してみる。

久保君のAIとは合計20戦行った。（現在提出しているこのバージョンになってから）
結果は7勝13敗と、まだまだ改善の余地があることがわかる。

そこで、1局1局を見ていくと、私のオセロAIは、"自分が指した1手によってひっくり返る石がその後に与える影響"　についての予測が甘いということが分かった。

具体的に言うと、
盤面の対角線上（角以外）に相手の石が並んでいる状況において、角のすぐ斜め隣りをひっくる返してしまうような手を迷いなく打ってしまっているシーンが散見されたのだ。
例えば、以下のような盤面である。(Xが自分の駒)

 |A B C D E F G H
-+----------------
1|    X O
2|    O O
3|X X O O X O
4|X   O X O
5|X X X O X O
6|X O O   O X
7|  O         X
8|              X

↓↓↓ 自分,C8に打つ

 |A B C D E F G H
-+----------------
1|    X O
2|    O O
3|X X O O X O
4|X   O X O
5|X X X O X O
6|X O O   O X
7|  X         X
8|    X         X

打ち手が人間であれば、このシーンにおいてc8には打たないだろう。なぜなら、次の手で相手が確実にa8を取れてしまうからである。
このような挙動をする原因としては、c8の中盤における静的なマス目上での評価値に4という高い値を設定してしまったことが考えられる。
しかし、この評価値は様々なオセロAIで実際に参照されている評価値であるため、まるっきりこれを否定するわけにもいかない。
つまり、たまに訪れるこういった珍しい局面以外においては、この4という評価値はあながち間違ってはいないと考えられるため、動的に盤面の次の展開を見て、もし角、もしくは評価値の高いマス目を持っていかれるような手であれば、別途ペナルティを課すような実装を付け加えれば、より強くなる可能性がある。


また、これはランダムに打つ初期オセロAIとの1局において起きていた一例なのだが、角をこちらが4つ取っているにもかかわらず、敗北している試合が存在した。
以下のような盤面である。（Xが自分）

 |A B C D E F G H
-+----------------
1|X X X X X X O X
2|X X O O X O O X
3|X O X X O O O X
4|O O O X O X O X
5|O O O O X O O O
6|O O O O O X O X
7|O O O O X O O X
8|X X X X X O O X
You lose! (29 vs. 35)

この盤面に至る過程を確認していくと、あまり有効な角の取り方ができていないことに気づいた。
例えば、以下のシーン。

 |A B C D E F G H
-+----------------
1|    X X X X
2|    O X   O   O
3|X O X O X X O X
4|  X X X O O
5|X X X X O O
6|X X X O X X O
7|  O X     X
8|X X X X X
  (X: Black,  O: White)
Sent: MOVE H1
Received: ACK 596909
Received: MOVE E2
 |A B C D E F G H
-+----------------
1|    X X X X   X
2|    O O O O   X
3|X O X O O X O X
4|  X X X O O
5|X X X X O O
6|X X X O X X O
7|  O X     X
8|X X X X X
  (X: Black,  O: White)

角を取ることに成功はしているが、あまり有効な手にはなっていないことが見て取れる。
というのも、1行目のG1に相手が駒を置ければ、そこが各定石にできてしまうからである。
また、1列目にもまだ石がほとんど並んでいないことから、この角を取ったことによって、盤面に与えられているえいきょうが極端に少ないのだ。

このようなケースを回避するためには、角があれば何を差し置いても取りに行く、という実装ではなく、自分だけが角を取れるという状況を維持できるのであれば、限界まで相手を泳がせておいて、最も利益が大きくなるシーンで角を奪取する、という戦法をとらせるのがよいのではないだろうか。


このように、最初は盤石だと思って作ったオセロAIでも、他者との対戦において容易に脆弱性が見つかるため、他社との対戦経験による自己反省にはとても大きな意味があると再認識した。